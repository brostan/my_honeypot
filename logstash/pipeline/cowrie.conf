input {
  file {
    path => "/cowrie-logs/log/cowrie/cowrie.json"
    codec => json
    type => "cowrie"
    start_position => "beginning"
  }
}

filter {
  if [type] == "cowrie" {
    date {
      match => [ "timestamp", "ISO8601" ]
    }
    
    # Extract useful fields
    if [src_ip] {
      geoip {
        source => "src_ip"
        target => "geoip"
      }
    }
    
    # Add tags based on event type
    if [eventid] == "cowrie.login.success" {
      mutate {
        add_tag => [ "login_success" ]
      }
    }
    
    if [eventid] == "cowrie.login.failed" {
      mutate {
        add_tag => [ "login_failed" ]
      }
    }
    
    if [eventid] == "cowrie.command.input" {
      mutate {
        add_tag => [ "command" ]
      }
    }
    
    if [eventid] == "cowrie.session.file_download" {
      mutate {
        add_tag => [ "file_download" ]
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "cowrie-%{+YYYY.MM.dd}"
  }
  
  # Debug output (optional, comment out in production)
  # stdout {
  #   codec => rubydebug
  # }
}

